local Internal: table = require("@env/internal")
local Manager: table = require("@env/manager")
local Tables: table = Manager.create()

Tables:define("getrawmetatable", function(Table: table): table
  Tables:checktype(1, Table, "table", "userdata", "string")
  
  if typeof(Table) == "string" then
    return getmetatable(Table)
  end
  
  return Internal.Metatables[Table] :: table
end)

Tables:define("setrawmetatable", function(Table: table, Metatable: table): table
  Tables:checktype(1, Table, "table")
  Tables:checktype(2, Metatable, "table")
  
  local MT: table = Internal.Metatables[Table]
  if not MT then
    Internal.Metatables[Table] = Metatable
    return setmetatable(Table, Metatable)
  end
  
  if MT.__metatable then
    MT.__metatable = nil
  end
  
  Internal.Metatables[Table] = Metatable
  return setmetatable(Table, Metatable) :: table
end)

Tables:define("hookmetamethod", function(Table: table, Method: string, New: any)
  Tables:checktype(1, Table, "table")
  Tables:checktype(2, Method, "string")
  Tables:checktype(3, New, "function", "table", "userdata", "string", "number")
  
  local MT: table = Internal.Metatables[Table]
  if not MT then
    return Table
  end
  
  local Old: any? = MT[Method]
  MT[Method] = New
  
  return Old :: any?
end)

return Tables:export() :: table